version: '3.8'

services:
  servicea:
    build:
      context: .
      dockerfile: Dockerfile.server
    environment:
      SERVICE_NAME: A
      PORT: 1099
    ports:
      - "1099:1099"
    container_name: rmi-servicea

  serviceb:
    build:
      context: .
      dockerfile: Dockerfile.server
    environment:
      SERVICE_NAME: B
      PORT: 1099
    ports:
      - "1100:1099"
    container_name: rmi-serviceb

  servicec:
    build:
      context: .
      dockerfile: Dockerfile.server
    environment:
      SERVICE_NAME: C
      PORT: 1099
    ports:
      - "1101:1099"
    container_name: rmi-servicec

  serviced:
    build:
      context: .
      dockerfile: Dockerfile.server
    environment:
      SERVICE_NAME: D
      PORT: 1099
    ports:
      - "1102:1099"
    container_name: rmi-serviced

  servicee:
    build:
      context: .
      dockerfile: Dockerfile.server
    environment:
      SERVICE_NAME: E
      PORT: 1099
    ports:
      - "1103:1099"
    container_name: rmi-servicee

  client:
    build:
      context: .
      dockerfile: Dockerfile.client
    depends_on:
      - servicea
      - serviceb
      - servicec
      - serviced
      - servicee
    volumes:
      - ./results:/app/results
    command:
      - "--targets"
      - "servicea,serviceb,servicec,serviced,servicee"
      - "--requests"
      - "5000"
      - "--concurrency"
      - "10"
      - "--work_ms"
      - "10"
      - "--input"
      - "5"
      - "--out"
      - "/app/results/results.csv"
    container_name: rmi-client
